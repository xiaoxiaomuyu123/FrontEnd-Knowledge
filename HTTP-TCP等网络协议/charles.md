# Charles     
Charles是一个HTTP代理/ HTTP监视器/反向代理，使开发人员能够查看其机器和Internet之间的所有HTTP和SSL / HTTPS流量。这包括请求，响应和HTTP标头（包含cookie和缓存信息）
    
Charles 是在 Mac 下常用的网络封包截取工具，在做 移动开发时，我们为了调试与服务器端的网络通讯协议，常常需要截取网络封包来分析。        

Charles 通过将自己设置成系统的网络访问代理服务器，使得所有的网络访问请求都通过它来完成，从而实现了网络封包的截取和分析。      

除了在做移动开发中调试端口外，Charles 也可以用于分析第三方应用的通讯协议。配合 Charles 的 SSL 功能，Charles 还可以分析 Https 协议    

## 1. Charles 可以做什么
- 抓取 Http 和 Https 的请求和响应，抓包是最常用的了。
- 重发网络请求，方便后端调试，复杂和特殊情况下的一件重发还是非常爽的（捕获的记录，直接 repeat 就可以了，如果想修改还可以修改）。
- 修改网络请求参数（客户端向服务器发送的时候，可以修改后再转发出去）。
- 网络请求的截获和动态修改。
- 支持模拟慢速网络，主要是模仿手机上的 2G/3G/4G 的访问流程。
- 支持本地映射和远程映射，比如你可以把线上资源映射到本地某个文件夹下，这样可以方面的处理一些特殊情况下的 bug 和线上调试（网络的 css，js 等资源用的是本地代码，这些你可以本地随便修改，数据之类的都是线上的环境，方面在线调试）；
- 可以抓手机端访问的资源（如果是配置 HOST 的环境，手机可以借用 host 配置进入测试环境）  

## 2. Charles 的原理   
当客户端向服务器发起请求的时候，先到 charles 进行过滤，然后 charles 在把最终的数据发送给服务器；  

注意：此时 charles 发给服务器的数据，不一定是客户端请求的数据；charles 在接到客户端的请求时可以自由的修改数据，甚至可以直接 Block 客户端发的请求；

服务器接收请求后的返回数据，也会先到 charles，经过 charles 过滤后再发给客户端；

同理：客户端接收的数据，不一定就是服务器返回的数据，而是 charles 给的数据；

正因为上面的原理，所以 charles 能实现的功能，对前端开发者来说非常有吸引力，相当于请求和响应都可控的，而且 charles 为了控制更加方面，提供很多简洁的操作；

- 注意
如果想要抓包，第一件事情，就是把 charles 设置成为本机和服务端之间的”过滤器”；

    让所有的网络请求全部经过 charles，这样就可以捕获并记录到你请求的内容和返回数据了，原理请参照上面那张图片；需要注意的是，如果你访问的是 web，可以把所有请求抓到；

    但如果你想抓某些应用（比如手机上的应用等），应用使用的某些资源，如果没有向服务器发送请求，而是通过调用内部资源的方式进行展现，那么此时 charles 是抓不到的；验证这个的方式很简单，就是把网络断掉后，如果还可以继续展现，就是属于调用内部资源的，这种时候就不要想着通过抓包工具来捕获资源了，他都没有像服务器发起请求，手机点烂也抓不到的；

- 需要明白一个可能存在的弊端，如果你把手机的上网相关事情委托给了charles，那么当charles出错或者没有开启的时候，此时手机必定没有办法正常上网；这个一定要了解，因为很多人把手机的IP委托给charles进行代理后，第二天早晨上本的时候，手机wifi会默认链接你常用的高清度wifi；而此时的wifi的设置里面可能已经委托给charles了，但是此时电脑刚没有开charles或者重启后ip变动等；造成charles无法正常使用；由此而导致了无法上网的问题；



  

## charles 手机抓包设置



