# Linux 基础与应用    

## 一、Linux 基础

### 1.1 linux 简介和概述
- 免费、开源
- 不同的发行版有自己的包管理系统
- 帮助：对命令不了解的话可以用这两个命令查看
    
    - man
    - info
### 1.2 文件管理
 操作系统最基础的就是文件管理     
 
 - ls 
    `ls 目录名` 可以看到指定目录名下的文件   
    
    - `ls -a` 在文件中是有隐藏文件的，这些隐藏文件以 点 开头，可以使用 `ls -a` 查看目录中的隐藏文件。每个目录下都有两个特殊的目录，点和点点。点
  表示当前目录，点点表示上一级目录。所以 `cd ..` 就是回到上一级目录   
    - `ls -l` 查看文件的详细信息 
    
    - `ls -lh` 带单位的查看文件的大小，其他的详细信息和 `ls -l` 没有区别
    
    - `ls -lsrt` 让文件以时间升序排列 
- `pwd` 查看当前在那个目录下，会显示完整的目录结构

- cd 命令

    - `cd -` 表示回到上一次的目录    
    - `cd ~` 所有文件都挂在根目录下，根目录用 / 表示
    - `cd ~` 当前用户的 home 目录用 ～ 表示
    - `cd` 后面没有任何参数表示进入 home 目录   
    
- cp = copy

    - `cp 原文件名 复制的文件名`
    - `cp -r` 表示复制目录，-r 表示递归的复制  

- mv = move  可以重命名一个文件目录，也可以将一个目录移动到另外的文件夹之下   

    - `mv 要移动的文件或文件目录 要移动到的位置`

- rm = remove 用来删除文件或目录

    - `rm 文件名或文件路径`
    - `rm -r` 删除目录 -r 表示递归，所以就是递归删除
    - `rm -f` 如果一个文件不存在，执行 `rm 不存在的文件` 这样会报错，那么加上 -f 这个参数，就不会报错了，把这个错误屏蔽掉  
    - `rm -rv` v 参数表示在操作的时候操作了哪些文件，所以这个命令的意思就是，在删除这个目录的时候都删除了哪些文件
 
- ln = link 链接，类似于 window 下的快捷方式。链接相当于指向一个文件的标识。我们可以把另外一个目录的文件建立一个链接放在当前的目录下，这样就可以在当前这个目录下直接访问这个文件了。

    - 硬链接和软连接：硬连接是两个目录指向了同样的文件，在任何一个目录删除这个文件，这个文件都不会真正的删除。只有把所有的硬连接都删除才会删除掉这个文件。软连接只是建立了一个符号，这个符号记录了真正的文件路径，也就是说如果把源文件删除了，这个软连接就没有作用了。
    
    - `ln 文件名 文件名`  只能对文件建立硬连接，目录是没有办法建立硬连接的，目录要建立软连接。修改其中一个文件的内容，另外的文件中的内容也会被修改 
    - `ln -s 文件a 文件b ` 建立软连接，或者叫符号链接，这是在文件 b 是文件a 的软链接。删除软连接不会整整的删除文件，只是删除了一个符号
    - `ln -f` 如果文件或者链接已经存在了，就用 -f 这个参数将链接或者文件覆盖掉
 
- `du = disk usage` 统计文件或者文件夹占用的大小
- `df = disk free` 查看磁盘每个分区的情况，默认的是字节，所以加上 -h 参数，方便看大小   
- `find` 文件的查找

    - 按时间/类别/名称等查找文件    
    
        - `find -name "*.html"`
    
    - 查找后可以执行操作
    
- `where is` 看可执行的文件在那个目录下的
- `which` 和 where is 差不多 

### 1.3 权限管理

linux 天生是为多用户的环境设计的，所以对用户和权限有着非常严格的限制
 - Group/gid：每个 group 有个 gid
 - User/uid：用户就是一个 user，user 可以有多个 group，每个用户有一个 uid。系统内部使用 uid 和 gid 记录，他们的值是整数
 - root 用户：是系统内特殊的用户，对系 统内所有的资源都有操作的权利。root 用户的 uid 和 gid 是零
 - 文件系统：受权限管理
 - 进程：受权限管理
 - 其他资源：受权限管理

#### 1.3.1 文件系统    

- user/group
- 三比特位分别代表读、写、执行

    ![](./note-pic/drwxr.png)        
    
    第一列表示权限，第三列表示那个用户，第四列表示该用户属于哪个组    
    第一列权限解读：前面三位表示该文件的 owner 对他有什么权限。d 表示是目录 

    - rwx 表示 读权限 写权限 可执行权限
    - 数字表示       
      ![](./note-pic/number.png)
    
- 目录的可执行权限
- 特殊权限：suid、sgid、sticky 不用太关注这三个权限
- 修改文件的权限：     

    - chown = change owner 
    - chgrp = change group 
    - chmod = change mode 改变文件的权限     
    
- su = switch user 后面不加用户名表示切换到 root，不推荐使用这个命令，推荐使用 sudo 命令
- sudo: 以另外的用户来运行一条命令，以 root 的权限来运行的    

    - `sudo -u tom ls 文件名` 以 tom 这个用户的权限来运行一条命令

### 1.4 文本操作

- `cat 文件名`：输出一个文件的内容
- `head 文件名`： 当一个文件很大，用 cat 不合适，就用 head 命令，比如在输出日志文件的时候，  

    - `head -n行数 文件名或文件路径` 可以用 head 制定输出文件的哪些行
    
- `tail`  用法和 head 一样，作用是看后面几行
 
    - `tail -f` ： 当文件还在不停的写信的内容时候，这条命令会把新的内容输出
    
- `more`： 只能向后看不能看前面的

- `less -f 文件名或文件路径`： 比 more 的命令灵活好用。输入 `：第几行g`，表示跳到第几行。

    - `:/关键字` 可以按照关键字查找内容，按 n 是下一个，按 shift+n 是上一个匹配。ctr+u 向上翻页，ctr+d 向下翻页。空格也是向下翻页

- `grep` : 如果一个文件很大，我们只对某些行感兴趣就用 grep。可以使用简单的正则表达式： `grep "正则表达式" 文件名`。还可以给匹配命中的地方加一个颜色，这样方便查看。 `grep --color "正则表达式" 文件名`

    - `grep 关键字 文件名`：
    - `-v` :
    - `-E/egrep`:
    - `--color`:
    
- `sort 文件名`: 对文件进行排序，首字母排序

    - `sort -k`： 指定某一列
    - `sort -n`： 当作数字来排序
    - `sort 文件名 -r`：倒序排列
    
- uniq = unique  去重的命令，相同的行只输出一次
    -  `uniq -c` ：输出这个行，后面是这个行出现的次数。但是如果两个相同的行中间隔开，就不会被去重了。所以要和 sort 命令联合使用。

- wc = word count 统计文件的行数，单词数，字节数

    - `wc -c` 字节数
    - `wc -l` 行数

awk 和 sed 学习成本比较高：可以看 《sed&awk》    
- awk = Aho Weiberger and Kernighan     

- sed = stream editor 流式编辑器   

    - awk 'FNR>=10 && FNR<=20{print $0}'
    - sed -n '10,20p'
    - awk 'FNR===NR{note[$0]} FNR<NR{if(!($0 in note)){print $0}}' a b
    - sed '/^$/d'

- 要掌握的 Vim

    - `vim 文件名`： 打开文件。大写的 G 跳到文件的结尾，两次小写的 g 跳到文件的开头。`/关键字` 找到匹配的内容，按 n 往下找匹配，按 N 往上找匹配
    - 模式切换：命令模式只能执行命令；
    - 光标移动：
    - 删除/复制/粘贴/插入：两次 d 可以删除一行，按 u 撤销操作；按 p 是粘贴刚刚的 dd 的哪一行。按 i 可以插入。按 esc 就是从编辑模式到命令模式。按 ： 就是底行命令模式。按 w 就是保存，按q 就是退出，按：wq就是保存并退出，s 是 wq 的缩写，按 s 也可以。按`:wq!`强制保存并退出。
    - 文本查找：
    - 退出保存：

### 1.5 打包与压缩

- gzip/bzip2： 压缩命令。现在用 tar 这个命令就可以啦
- tar：     

    - `tar 文件名.tgz 文件名` : tgz 表示这是一个 tar 包，并且是以 giz 压缩的。
    - `tar -tvz 压缩的文件名`：只是想看压缩文件的内容，但是不解压
    - `tar -xzf 文件名`： 解压

- zip：

- unzip：

- zcat/zgrep/zmore/zless.... 查看压缩文件 

## 二、http 请求与传输
课程目标：linux 中常用的网络请求命令；网络相关工具软件；进程、内存、cpu等信息的查看     

### 2.1  curl 在网络中获取和传输数据，在 web 开发中，使用 curl 来模拟 http 请求     

- curl
http 请求的请求部分：请求行，请求头，消息体。curl 可以通过各个参数模拟 http 请求
    ![](./note-pic/curl-1.jpg)     
    
    - 将 cookie 保存到指定的文件 
    - 设定请求头信息的 cookie  `curl -H 'Cookie:q-b;c-d' www.qunar.com`
    - 格式化输出： `curl -w %{http_code} www.qunar.com` 就可以格式化输出状态码
    - post 请求 联合抓包工具使用，没看懂

- wget 通常用于下载文件 `wget 网址`

## 三、网络常用工具命令

- ping：检测网络连通性，连接可达性的命令，测试服务器有没有死掉

    - `ping -q www.baidu,com` 不加 -q 就会一直输出，加上 -q 就是一直 ping 但是静默输出

- host：和 dns 解析 相关的命令

    - `hostname` 获取本地的主机名
    - `ifconfig` 获取哥哥虚拟网卡的ip地址
    - `host ip地址` 获取对应的主机名 
    
- nc：用来网络发包，可以发送 tcp 和 udp 的数据包

    - -l 监听
    - -t 发送 tcp
    - -u 发送 udp
    
    据说可以实现简单的聊天软件，但是呢，没有看懂

- telnet 协议的工具：远程登陆和 tcp 链接测试

- netstat： 查看本机的网络连接和网络端口信息

- tcpdump： 常用的抓包工具


## 四、远程命令

- ssh：用于安全的远程登录



- scp：远程拷贝



## 五、进程与系统

- ps：显示进程和线程信息

- free：查看 linux 进程的使用情况

- top：交互式动态的显示当前的 cpu 内存的使用情况

- kill：向指定的进程发送指定的信号





## 六、shell脚本编程&提高

### 6.1 shell 脚本编程上
- 创建多个文件

    ![](./note-pic/shell1.png)       
    
    - `cat 文件名` 查看该文件的内容
    - `文件目录` 执行文件
    - 图片中第一行 指定了脚本解析器

### 6.2 shell 脚本编程下

![](./note-pic/shell2.png)    

![](./note-pic/shell3.png)

![](./note-pic/shell4.png)   

![](./note-pic/shell5.png)

![](./note-pic/shell6.png)

运行文件
- 先加权限： `chmod u+x *.sh`
- `./文件名.sh 直接输入传入的参数` 这样就可以直接运行脚本了    

![](./note-pic/shell7.png)

![](./note-pic/shell8.png)  

注意条件表达式 if 后面的 中括号 前后都要有空格，乘法要注意有转义字符

![](./note-pic/shell9.png)    

关系运算符只针对于数字 

![](./note-pic/shell10.png)
布尔运算符   

![](./note-pic/shell11.png)


- 字符串运算符

    ![](./note-pic/shell12.png)    
    
    
- 判断文件存不存在，可不可读，是不是空    

    ![](./note-pic/shell13.png)   
    ![](./note-pic/shell14.png)
    
- shell 流程控制      

    ![](./note-pic/shell15.png)    
    
    ![](./note-pic/shell16.png)  
    
    ![](./note-pic/shell18.png)  
    最好不要用上引号包含循环体，要用花括号    
    
    ![](./note-pic/shell19.png)       
    
    ![](./note-pic/shell20.png)   
    
    ![](./note-pic/shell21.png)
     
- 函数       

    ![](./note-pic/shell22.png)    
    
    - 没有返回值的函数
        
        ![](./note-pic/shell23.png)   
        
    - 返回值要被接收，否则会被冲掉     
    
        ![](./note-pic/shell24.png)   
        
    - 函数接收参数    
    
        ![](./note-pic/shell25.png)   
        
    - 
    




### 6.3 提高










##### 题目1 文件检测和目录创建
输入：路径
输出：如果某路径不存在，则将其创建为目录；否则显示其存在，并输出其是目录还是文件
##### 题目2 文件行统计
(1) 传递两个文本文件路径给脚本 
(2) 输出两个文件中空行数较多的文件名字及其空行的个数
(3) 输出两个文件中总行数较多的文件名字及其总行数
##### 题目3 重复文件查找
编写脚本，输入一个或者多个目录，查找和输出这些目录中内容相同的文件，将相同的文件分组输出。
注: 判断文件内容是否相同，可以使用文件md5值。
##### 题目4 curl练习
###### 服务地址
l-marmotui1.wap.beta.cn0.qunar.com:1853
###### 登录
> 接口
|接口|解释|请求|
|-|-|-|
|/graduate/api/login|登录接口|POST，表单提交|

> 参数
|名字|类型|解释|
|-|-|-|
|username|String|用户名|
|password|String|密码明文|

> 返回
|名字|类型|解释|
|-|-|-|
|code|int|状态码|
|errMsg|String|错误说明|

> 说明
用户名:graduate
密码:graduate_password
返回值格式为json，code为0时，表示访问成功
###### 提交
> 接口
|接口|解释|请求|
|-|-|-|
|/graduate/api/submit|提交信息接口|POST，json数据|

> 参数
|名字|类型|解释|
|-|-|-|
|name|String|姓名|
|mobile|String|手机号|
|people_num|int|人数|

> 返回
|名字|类型|解释|
|-|-|-|
|code|int|状态码|
|errMsg|String|错误说明|

> 说明
返回值格式为json，code为0时，表示访问成功
##### 题目5 AWK练习
从下面日志获取flightnum值和main flightnum值（提示gawk gensub函数的使用）
日志：
flightnum is CA1230，main flightnumMU1230
flightnum is MU1111，main flightnumCA1111
输出：
CA1230 MU1230
MU1111 CA1111
